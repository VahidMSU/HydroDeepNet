<VirtualHost *:80>
    ServerName ciwre-bae.campusad.msu.edu

    # Serve the React build output
    DocumentRoot /data/SWATGenXApp/codes/web_application/frontend/build
    <Directory /data/SWATGenXApp/codes/web_application/frontend/build>
        Require all granted
        AllowOverride All
        Options Indexes FollowSymLinks
    </Directory>

    # Let Apache preserve the Host header, disable open proxy
    ProxyPreserveHost On
    ProxyRequests Off

    # Proxy API requests to Gunicorn on port 5050
    ProxyPass        /api/ http://127.0.0.1:5050/api/
    ProxyPassReverse /api/ http://127.0.0.1:5050/api/

    # Proxy WebSocket requests (if you use websockets)
    ProxyPass        /ws ws://127.0.0.1:5050/ws
    ProxyPassReverse /ws ws://127.0.0.1:5050/ws

    # Proxy login requests
    ProxyPass        /login http://127.0.0.1:5050/login
    ProxyPassReverse /login http://127.0.0.1:5050/login

    # Serve React static files directly
    Alias /static/react /data/SWATGenXApp/codes/web_application/frontend/build/static
    <Directory /data/SWATGenXApp/codes/web_application/frontend/build/static>
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride None
    </Directory>

    # Legacy static files (images, videos, etc.)
    Alias /static/images /data/SWATGenXApp/GenXAppData/images
    <Directory /data/SWATGenXApp/GenXAppData/images>
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride None
        Header set Access-Control-Allow-Origin "*"
    </Directory>

    Alias /static/videos /data/SWATGenXApp/GenXAppData/videos
    <Directory /data/SWATGenXApp/GenXAppData/videos>
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride None
        Header set Access-Control-Allow-Origin "*"
    </Directory>

    # Allow access to user directories
    <Directory /data/SWATGenXApp/Users>
        Require all granted
    </Directory>

    # React frontend routing fallback: anything that isnâ€™t /api/, /ws, /static/, or a real file
    RewriteEngine On
    RewriteCond %{REQUEST_URI} !^/api/
    RewriteCond %{REQUEST_URI} !^/ws
    RewriteCond %{REQUEST_URI} !^/static/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ /index.html [QSA,L]

    # Logs
    ErrorLog  /data/SWATGenXApp/codes/web_application/logs/react_flask_error.log
    CustomLog /data/SWATGenXApp/codes/web_application/logs/react_flask_access.log combined
</VirtualHost>
